library(data.table)

setwd("D:/Y2 sem 2/BC2407/Project/Malware")
dataset.dt <- fread('updated_data_1.csv', stringsAsFactors = T)

malware_data <- dataset.dt[,.(Census_ProcessorCoreCount,
                              Processor,
                              Firewall,
                              Census_PrimaryDiskTypeName,
                              Census_SystemVolumeTotalCapacity,
                              Census_HasOpticalDiskDrive,
                              Census_TotalPhysicalRAM,
                              Census_InternalPrimaryDiagonalDisplaySizeInInches,
                              Census_IsTouchEnabled,
                              HasDetections
                             )]

malware_data$Census_ProcessorCoreCount <- factor(malware_data$Census_ProcessorCoreCount)
malware_data$Processor <- factor(malware_data$Processor)
malware_data$Firewall <- factor(malware_data$Firewall)
malware_data$Census_HasOpticalDiskDrive <- factor(malware_data$Census_HasOpticalDiskDrive)
malware_data$Census_TotalPhysicalRAM <- factor(malware_data$Census_TotalPhysicalRAM)
malware_data$Census_IsTouchEnabled <- factor(malware_data$Census_IsTouchEnabled)
malware_data$HasDetections <- factor(malware_data$HasDetections)


malware_log <- glm(malware_data$HasDetections ~ . , family = binomial, data = malware_data)

# Significant variables: 
# Census_ProcessorCoreCount
# Firewall
# Census_SystemVolumnTotalCapacity
# Census_HasOpticalDiskDrive
# Census_InternalPrimaryDiagonalDisplaySizeInInches
# Census_IsTouchEnabled


prob <- predict(malware_log, type = 'response')

threshold <- sum(malware_data$HasDetections == 1)/length(malware_data$HasDetections)

malware.hat <- ifelse(prob > threshold, 1, 0)

table(malware_data$HasDetections, malware.hat)

mean(malware.hat == malware_data$HasDetections)